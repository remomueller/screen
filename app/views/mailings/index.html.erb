<% @title = "Mailings" %>
<h1><%= @title %></h1>

<%= form_tag mailings_path, method: :get, remote: true, id: "mailings_search", style: "margin-bottom:-5px" do %>
  <%= hidden_field_tag :order %>

  <fieldset>
    <legend>
      Search Filters
    </legend>
    <table class="blank padded" style="table-layout:fixed;width:100%;text-align:left;margin:10px 0px">
      <thead>
        <tr>
          <th>Search</th>
          <th>Sent Date After</th>
          <th>Sent Date Before</th>
          <th>Eligibility</th>
          <th>Exclude Ineligible From Calls, Evaluations, or Prescreens</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= text_field_tag 'mrn', params[:mrn] %></td>
          <td><%= text_field_tag 'sent_after', params[:sent_after], class: 'datepicker' %></td>
          <td><%= text_field_tag 'sent_before', params[:sent_before], class: 'datepicker' %></td>
          <td><%= select_tag 'eligibility', options_for_select(Mailing::ELIGIBILITY, params[:eligibility]) %></td>
          <td><%= check_box_tag 'ineligible', "1", params[:ineligible] %></td>
        </tr>
      </tbody>
    </table>
    <%= button_tag image_tag('gentleface/16/cog.png') + 'Filter Search' %>
    <%= link_to_function image_tag('gentleface/16/doc_lines_stright.png') + 'Export CSV', "window.location = $('#mailings_search').attr('action') + '.csv?' + $('#mailings_search').serialize();", class: 'button' %>
  </fieldset>
<% end %>

<div id="mailings"><div style="clear:both"></div><br /><center><%= image_tag "ajax-loader.gif" %></center></div>

<%= javascript_tag do %>
  $(function(){
    $.get($("#mailings_search").attr("action"), $("#mailings_search").serialize(), null, "script");
  });
<% end %>
