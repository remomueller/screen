<% @title = "Patient: #{@patient.code}" %>
<h1><%= @title %></h1>

<% if current_user.screener? or current_user.subject_handler? %> <%# current_user.all_patients.include?(@patient) %>
  <%= link_to image_tag('gentleface/16/doc_edit.png', alt: '') + "Edit Patient", edit_patient_path(@patient), class: 'button' %>
  <%= link_to image_tag('gentleface/16/doc_delete.png', alt: '') + "Delete Patient", @patient, confirm: "Are you sure you want to delete Patient #{@patient.name}?", method: :delete, class: 'button negative' %>
<% end %>
<%= link_to image_tag('gentleface/16/folder_open.png', alt: '') + "View All Patients", patients_path, class: 'button' %>
<div style="clear:both"></div>

<% unless @patient.priority_message.blank? %>
    <fieldset>
      <legend><%= image_tag 'gentleface/16/flag.png', style: 'vertical-align:text-bottom', alt: '', title: "Priority Level: #{@patient.priority}" %> Priority Followup</legend>
      <ul style="margin-bottom:0">
        <% @patient.priority_message.split(', ').each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </fieldset>
<% end %>

<table class="blank padded" style="width:100%;table-layout:fixed">
  <tr>
    <td style="vertical-align:top">
      <fieldset>
        <legend><%= image_tag 'gentleface/16/user.png', alt: '', style: 'vertical-align:text-bottom' %> Patient</legend>

        <p>
          <b>MRN:</b>
          <%= @patient.mrn %>
        </p>

        <p>
          <b>Subject Code:</b>
          <%= @patient.subject_code %>
        </p>

        <p>
          <b>Name Code:</b>
          <%= @patient.name_code %>
        </p>

        <p>
          <b>Name:</b>
          <%= @patient.name %>
        </p>

      </fieldset>
    </td>
    <td style="vertical-align:top">
      <fieldset>
        <legend><%= image_tag 'gentleface/16/phone_1.png', alt: '', style: 'vertical-align:text-bottom' %> Contact</legend>
        <p>
          <b>Home Phone:</b>
          <%= pretty_phone @patient.phone_home %>
        </p>

        <p>
          <b>Day Phone:</b>
          <%= pretty_phone @patient.phone_day %>
        </p>

        <p>
          <b>Alt Phone:</b>
          <%= pretty_phone @patient.phone_alt %>
        </p>
      </fieldset>
    </td>
    <td style="vertical-align:top">
      <fieldset>
        <legend><%= image_tag 'gentleface/16/mail.png', alt: '', style: 'vertical-align:text-bottom' %> Address</legend>
        <p>
          <b>Address:</b>
          <%= @patient.address %>
        </p>
      </fieldset>
    </td>
    <td style="vertical-align:top">
      <fieldset>
        <legend><%= image_tag 'gentleface/16/user.png', alt: '', style: 'vertical-align:text-bottom' %> Demographics</legend>
        <p>
          <b>Sex:</b>
          <%= @patient.sex %>
        </p>

        <p>
          <b>Age:</b>
          <%= @patient.age %>
        </p>
      </fieldset>
    </td>
  </tr>
</table>

<%= link_to image_tag('gentleface/16/3x3_grid.png', alt: '') + 'Create Prescreen', new_prescreen_path(patient_id: @patient.id), class: 'button positive' %>
<%= link_to image_tag('gentleface/16/mail.png', alt: '') + 'Create Mailing', new_mailing_path(patient_id: @patient.id), class: 'button positive' %>
<%= link_to image_tag('gentleface/16/phone_1.png', alt: '') + 'Create Call', new_call_path(patient_id: @patient.id), class: 'button positive' %>
<%= link_to image_tag('gentleface/16/cert.png', alt: '') + 'Create Evaluation', new_evaluation_path(patient_id: @patient.id), class: 'button positive' %>

<%= link_to image_tag('gentleface/16/users.png', alt: '') + 'Create Visit', new_visit_path(patient_id: @patient.id), class: 'button positive' %>

<div style="clear:both"></div>

<% if false %>
<%= form_tag events_path(patient_id: @patient.id, hide_patient: 1), method: :get, remote: true, id: "events_search", style: "display:inline" do %>
  <%= hidden_field_tag :order %>
<% end %>

<div id="events"><div style="clear:both"></div><br /><center><%= image_tag "ajax-loader.gif" %></center></div>

<%= javascript_tag do %>
  $(function(){
    $.get($("#events_search").attr("action"), $("#events_search").serialize(), null, "script");
  });
<% end %>
<% end %>

<%= @events = @patient.events.order("events.event_time DESC"); render partial: 'events/events_mini' %>

<%#= @order = 'events.event_time DESC'; @events = @patient.events.order(@order).page(0); render partial: 'events/events' %>
